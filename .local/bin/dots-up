#!/bin/bash
# updots
touch $HOME/.pkgs
touch $HOME/.fpkgs
touch $HOME/.pkgignore

# Do an update
cp -f $HOME/.pkgs $HOME/.pkgs.backup
sudo pacdiff_program="DIFFPROG=\"nvim -d\" pacdiff" pacmatic -Syu
paru -Syu

# Install Any PKGs needed but not ignored from .pkgs
paru -Qqen |
  sort |
  comm -23 <(sort $HOME/.pkgs) - |
  comm -13 <(sort $HOME/.pkgignore) - |
  paru -S - --needed

# Install Any Foreign PKGs needed but not ignored from .pkgs
paru -Qqem |
  sort |
  comm -23 <(sort $HOME/.fpkgs) - |
  comm -13 <(sort $HOME/.pkgignore) - |
  paru -S - --needed


# Regenerate .pkgs ignoring ignored pkgs
paru -Qqen |
  sort |
  comm -13 <(sort $HOME/.pkgignore) - > $HOME/.pkgs

paru -Qqem |
  sort |
  comm -13 <(sort $HOME/.pkgignore) - > $HOME/.fpkgs

# codium --diff $HOME/.pkgs.backup $HOME/.pkgs --wait
